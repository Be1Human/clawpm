# ClawPM — 全自动项目管理中枢 产品需求文档 (PRD)

> **版本**: v2.0  
> **日期**: 2026-03-01  
> **状态**: 迭代中  
> **变更记录**:  
> - v1.0 (2026-02-28): 初始版本 — 基于 PM-Agent PRD v0.4 重构为独立服务 + 纯 MCP 架构  
> - v1.1 ~ v1.4: 需求树、人员管理、甘特图、标签系统、关联图谱等迭代  
> - **v2.0 (2026-03-01): 颠覆性重设计** — 思维导图驱动，一切皆节点，先上车后补票，新状态体系，AI 自动拆解

---

## 一、背景与愿景

### 1.1 核心痛点

| 痛点 | 描述 |
|------|------|
| **进度黑箱** | 多个 Agent 各自开发，PM 无法实时掌握各模块进展 |
| **需求散落** | 决策者口头提的需求、Agent 发现的需求，没有统一收纳 |
| **创建摩擦大** | 传统 PM 工具要求填一堆字段才能创建需求，打断思维流 |
| **层级僵化** | Epic/Story/Task/Subtask 固定四层结构，实际使用中产生认知摩擦 |
| **Agent 不友好** | 缺少面向 AI Agent 的 MCP 接口，Agent 无法自主领取和上报 |
| **无可视化** | 没有思维导图、看板、甘特图等直观的项目全景视图 |

### 1.2 产品愿景

> **ClawPM = 思维导图式的需求树 + Human-in-the-Loop 的 GUI + Agent 友好的 MCP 接口**

核心思想：**需求管理应该像思维导图软件一样畅通无阻**。一个快捷键就创建好一个节点，先上车后补票——节点创建后可以慢慢完善细节，不需要在创建时填一堆繁文缛节。

```
┌─────────────────────────────────────────────────────────┐
│                 ClawPM — 项目管理中枢                      │
│                                                         │
│  ┌──────────┐     ┌──────────┐     ┌──────────┐        │
│  │ 人类决策者 │────►│ 思维导图   │◄────│ AI Agent  │        │
│  │  Web GUI  │     │ 需求树核心 │     │  MCP 接口 │        │
│  └──────────┘     └──────────┘     └──────────┘        │
│                                                         │
│  底层逻辑：思维导图式需求树 = 项目管理的数据中枢             │
│  上层交互：GUI（人看/管） + MCP（Agent 读/写）             │
└─────────────────────────────────────────────────────────┘
```

### 1.3 v2.0 设计哲学

1. **一切皆节点** — 没有 Epic/Story/Task/Subtask 之分，所有需求节点本质平等，只是粒度不同
2. **先上车后补票** — 创建节点只需要一个标题，甚至只需按一个 Tab 键；未完善的节点自动进入"未排期"状态
3. **思维导图为核心** — 主视图是思维导图，节点的创建、编辑、组织都以思维导图交互为中心
4. **标签而非类型** — 用可选的自定义标签（如 #epic #bug #feature）进行分类，不作为系统级约束
5. **AI 可拆解** — 支持 AI 根据一个高层需求自动拆解生成子节点树
6. **双通道交互** — GUI 给人用（Human-in-the-Loop），MCP 给 Agent 用（自动化流水线）

---

## 二、系统角色与交互模型

### 2.1 三方角色

```
           ┌──────────────────────────────────────┐
           │         ClawPM Server (中枢)          │
           │                                      │
           │   Web UI + REST API + MCP Server     │
           │   SQLite (Single Source of Truth)     │
           │                                      │
           └───┬──────────────┬───────────────┬───┘
               │              │               │
   MCP (SSE)   │   MCP (SSE)  │    Web/API    │
               │              │               │
  ┌────────────┴──┐   ┌──────┴────────┐  ┌───┴──────────┐
  │ Cursor Agent   │   │  OpenClaw      │  │  决策者/PM    │
  │ (本地开发端)    │   │  (服务器端 AI)  │  │  (浏览器)     │
  └───────────────┘   └───────────────┘  └──────────────┘
```

### 2.2 角色职责

| 角色 | 身份 | 与 ClawPM 的交互 |
|------|------|----------------|
| **决策者/PM** | 人类管理者 | 通过思维导图创建/组织需求，查看看板/甘特图/仪表盘 |
| **Cursor Agent** | 本地开发 AI | 通过 MCP 领取任务、上报进度、创建需求、报告阻塞 |
| **OpenClaw** | 服务器端 AI | 通过 MCP 拆解需求、排期调度、战略分析，通过飞书通知 |

---

## 三、核心概念

### 3.1 需求节点（Node）

系统中所有的需求、任务、想法统一为"节点"（Node）。节点之间通过父子关系构成树状结构，任何节点都可以有无限个子节点，没有深度限制。

```
需求节点
├── title        标题（唯一必填字段）
├── status       状态（见 3.2）
├── labels       可选标签数组（如 ["epic", "用户系统"]）
├── priority     优先级 P0/P1/P2/P3（默认 P2）
├── progress     进度 0–100（默认 0）
├── owner        负责人（可选）
├── description  详细描述（可选）
├── due_date     截止日期（可选）
├── parent_id    父节点 ID（null = 根节点）
└── [children]   子节点列表（递归）
```

### 3.2 节点状态体系（核心）

v2.0 重新定义了需求的状态流转，更贴合实际工作流：

```
快速创建（Tab/Enter）
       │
       ▼
┌──────────────┐
│   未排期      │  刚创建的节点，只有标题，尚未规划
│  (backlog)   │  → 想法池：先记下来，后续完善
└──────┬───────┘
       │ 完善细节并排入迭代
       ▼
┌──────────────┐
│   未开始      │  已排期，分配了负责人，等待启动
│  (planned)   │
└──────┬───────┘
       │ Agent 或人开始执行
       ▼
┌──────────────┐
│   进行中      │  正在开发/执行
│  (active)    │
└──────┬───────┘
       │ 完成开发，提交验收
       ▼
┌──────────────┐
│   验收中      │  产品验收 / 代码评审
│  (review)    │
└──────┬───────┘
       │ 验收通过
       ▼
┌──────────────┐
│   已完成      │  归档，更新统计
│  (done)      │
└──────────────┘
```

**关键设计决策：**
- 新创建的节点默认状态为 `backlog`（未排期），而不是 `planned`
- 去掉了 `blocked`（阻塞）和 `cancelled`（已取消）作为核心状态——这两个通过标签或 `blocker` 字段表达
- 5 个状态精简明确，映射清晰：想法 → 排期 → 执行 → 验收 → 完成

**看板映射：**

| 状态 | 看板列名 | 颜色 | 说明 |
|------|---------|------|------|
| `backlog` | 未排期 | 灰色 | 想法池，待完善 |
| `planned` | 未开始 | 蓝色 | 已排期，等待执行 |
| `active` | 进行中 | 靛蓝 | 正在执行 |
| `review` | 验收中 | 琥珀 | 待验收 |
| `done` | 已完成 | 绿色 | 已归档 |

### 3.3 标签系统（Labels）

标签是节点的**可选**分类标注，不影响节点的行为。系统预置推荐标签，用户可自由扩展：

| 推荐标签 | 说明 | 使用场景 |
|----------|------|---------|
| `epic` | 大功能方向 | 顶层需求聚合 |
| `feature` | 用户可见特性 | 一个完整的功能模块 |
| `bug` | 缺陷修复 | 问题追踪 |
| `spike` | 技术预研 | 调研、原型验证 |
| `chore` | 工程维护 | 重构、升级、部署 |

> **核心原则：** 标签仅用于分类和过滤，不限制节点的行为。一个打了 `epic` 标签的节点可以没有子节点，一个没有标签的节点也可以有 100 个子节点。

### 3.4 关联（Association）

除了父子树状关系，节点之间还支持横向关联：

| 关联类型 | 方向 | 语义 | 思维导图显示 |
|----------|------|------|------------|
| **阻塞依赖** (`blocks`) | 单向 | B 未完成，A 无法开始 | 红色虚线 + 箭头 |
| **顺序依赖** (`precedes`) | 单向 | 推荐先做 B 再做 A | 橙色虚线 + 箭头 |
| **弱关联** (`relates`) | 双向 | 主题相关，无依赖 | 蓝色虚线 |

关联规则：
1. 阻塞/顺序依赖不允许形成环路（系统自动检测）
2. 关联线可按类型独立显示/隐藏
3. 移动节点（换父节点）时关联保持不变

### 3.5 其他概念

| 术语 | 定义 |
|------|------|
| **业务板块 (Domain)** | 按领域划分的分组（如用户系统、支付系统），影响节点 ID 前缀 |
| **里程碑 (Milestone)** | 时间节点目标（如 v1.0-MVP） |
| **目标 (Goal)** | 高层目标 → KR → 关联节点 |
| **成员 (Member)** | 人类或 AI Agent，可指定为节点负责人 |

---

## 四、思维导图视图（核心交互）

### 4.1 设计原则

思维导图是 ClawPM 的**主视图**。它的 UX 目标是"像 XMind / MindNode 一样丝滑"：

1. **自动布局** — 节点位置由布局算法自动计算，用户不需要手动摆放
2. **子随父动** — 移动根节点时，整个子树跟随移动
3. **快捷键驱动** — Tab 创建子节点、Enter 创建同级、Delete 删除、双击改名
4. **内联创建** — Tab/Enter 后直接在思维导图上出现一个空白节点，输入标题后 Enter 确认即完成创建，无需弹窗
5. **折叠展开** — 子树可折叠/展开，折叠时显示子节点计数
6. **右键菜单** — 添加关联、折叠/展开、删除等高级操作

### 4.2 交互流程

```
思维导图操作流程

选中节点
  ├── Tab      → 内联创建子节点（出现空白节点，输入标题，Enter 确认）
  ├── Enter    → 内联创建同级节点
  ├── Delete   → 删除确认
  ├── 双击      → 内联编辑标题
  ├── 右键      → 上下文菜单（添加关联/折叠/删除/更多…）
  └── + 按钮   → 同 Tab，添加子节点

新节点创建后：
  → 状态自动设为 backlog（未排期）
  → 进入思维导图，可以慢慢完善详情（点击节点打开侧边栏编辑）
  → 不完善也不影响任何功能，先记下来就好
```

### 4.3 思维导图功能清单

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 内联创建节点 | Tab/Enter 即时创建，无弹窗阻塞 | **P0** |
| 自动树形布局 | 横向树形布局，子节点自适应位置 | **P0** |
| 子树跟随移动 | 拖拽根节点时整棵子树跟随 | **P0** |
| 折叠/展开 | 折叠子树，显示子节点计数气泡 | **P0** |
| 双击编辑标题 | 内联编辑，Enter 确认 Esc 取消 | **P0** |
| 状态色点 | 节点上显示状态对应的彩色圆点 | **P0** |
| 关联线显示 | 阻塞/顺序/弱关联线，可按类型开关 | P1 |
| 右键菜单 | 添加子节点/同级/关联/删除等操作 | P1 |
| 新建根节点 | 按钮创建新的根节点（新的树） | P1 |
| AI 自动拆解 | 选中节点 → 调用 AI 自动生成子节点树 | P2 |

### 4.4 AI 自动拆解需求（v2.0 规划）

选中一个节点后，通过 MCP 调用 AI Agent 自动拆解：

```
用户选中节点「用户系统」
  │
  ├── 右键 → "AI 拆解"
  │
  ▼
AI Agent 通过 MCP 调用：
  create_task("注册流程", parent="用户系统")
  create_task("登录流程", parent="用户系统")
  create_task("第三方 OAuth", parent="登录流程")
  create_task("权限管理", parent="用户系统")
  ...
  │
  ▼
思维导图自动刷新，显示 AI 生成的子树
```

> 拆解由 Agent 通过 MCP 完成，ClawPM 本身不包含 AI 能力。

---

## 五、其他视图

### 5.1 看板（Kanban）

按状态列展示节点卡片，支持拖拽改变状态：

| 未排期 | 未开始 | 进行中 | 验收中 | 已完成 |
|--------|--------|--------|--------|--------|
| 想法… | 注册API | 登录模块 | 支付v2 | OAuth |
| 积分系统 | RBAC | | | 注册页 |

- 拖拽卡片到目标列 → 自动更新状态
- 卡片显示：标题、ID、标签、优先级、负责人、进度、截止日期

### 5.2 任务列表

表格视图，支持按状态/标签/负责人/里程碑筛选排序。信息密度高，适合批量查看。

### 5.3 需求树（列表形态）

与思维导图同一份数据，以缩进列表形式展示，信息更密集：
- 支持展开/收起
- 支持标签/状态/里程碑过滤
- 每行显示：标题、ID、标签、状态、进度、负责人、+ 按钮

### 5.4 甘特图

按时间线展示有日期的节点，支持按板块/负责人分组。

### 5.5 仪表盘

项目概览：总节点数、各状态分布、健康度、业务板块进度、风险预警、人员负载。

---

## 六、人员与 Agent 管理

### 6.1 成员模型

```
Member（成员）
├── type: human | agent
├── name: 显示名称
├── identifier: 唯一标识（= 节点的 owner 字段值）
├── color: 头像颜色
└── description: 描述/职责
```

### 6.2 功能需求

| ID | 功能 | 描述 | 优先级 |
|----|------|------|--------|
| PM-01 | 成员列表 | 展示所有成员（人+Agent），支持按类型筛选 | P0 |
| PM-02 | 创建成员 | 填写 name、type、identifier、color | P0 |
| PM-03 | 成员详情 | 该成员负责的任务列表、工作量分布 | P1 |
| PM-04 | 负责人选择 | 节点编辑时从成员列表选择 owner | P0 |

---

## 七、MCP 工具定义

ClawPM 通过 MCP Server (SSE) 暴露工具，供 Cursor Agent 和 OpenClaw 调用。

### 7.1 节点管理工具

| Tool | 参数 | 描述 |
|------|------|------|
| `create_task` | title, parent_task_id?, labels?, priority?, owner?, due_date?, description? | 创建节点（只需 title） |
| `get_task` | task_id | 获取节点详情 |
| `update_task` | task_id, 可更新字段... | 更新节点 |
| `update_progress` | task_id, progress, summary? | 上报进度 |
| `complete_task` | task_id, summary? | 标记完成 |
| `report_blocker` | task_id, blocker_description | 报告阻塞 |
| `add_task_note` | task_id, content | 添加备注 |
| `list_tasks` | filters (status?, label?, owner?, priority?) | 按条件查询 |
| `get_my_tasks` | owner | 获取我的任务 |
| `request_next_task` | owner?, domain? | 推荐下一个任务 |
| `get_task_tree` | domain? | 获取完整需求树 |
| `reparent_task` | task_id, new_parent_task_id? | 移动节点到新父节点 |

### 7.2 需求池工具

| Tool | 参数 | 描述 |
|------|------|------|
| `create_backlog_item` | title, description?, priority?, tags? | 录入需求池 |
| `list_backlog` | filters? | 查看需求池 |
| `schedule_backlog_item` | backlog_id, milestone?, owner? | 排期 |

### 7.3 关联工具

| Tool | 参数 | 描述 |
|------|------|------|
| `create_req_link` | source_task_id, target_task_id, link_type | 创建关联（含循环检测） |
| `delete_req_link` | link_id | 删除关联 |
| `list_req_links` | task_id? | 查看关联 |

### 7.4 配置/查询工具

| Tool | 参数 | 描述 |
|------|------|------|
| `get_project_status` | — | 项目整体状态 |
| `get_risk_report` | — | 风险清单 |
| `create_domain` | name, task_prefix | 创建业务板块 |
| `create_milestone` | name, target_date? | 创建里程碑 |

---

## 八、OpenClaw 集成

OpenClaw 是 ClawPM 的"AI 大脑层"。ClawPM 只负责数据存储和展示，所有智能分析由 OpenClaw 通过 MCP 完成。

**核心场景：**

| 场景 | OpenClaw 通过 MCP 执行 |
|------|----------------------|
| 收集需求 | 飞书消息 → `create_task(title, labels=["feature"])` |
| 拆解需求 | AI 分析需求 → 批量 `create_task` 生成子节点树 |
| 日报 | `get_project_status` → 分析 → 飞书推送 |
| 风险预警 | `get_risk_report` → 飞书 @相关人 |
| 排期建议 | `list_tasks(status=backlog)` → 建议排入里程碑 |

---

## 九、文档绑定机制

本地 Cursor Agent 的 DesignDoc 通过 frontmatter 中的 `pm_task_id` 与 ClawPM 节点绑定：

```yaml
---
pm_task_id: "U-042"
pm_server: "https://pm.example.com"
---
```

---

## 十、风险分析引擎

ClawPM 内置基础风险检测能力（不依赖 AI）：

| 功能 | 规则 |
|------|------|
| 逾期检测 | `due_date < today && status != done` |
| 逾期预警 | `due_date - today <= 3天 && progress < 80%` |
| 停滞检测 | 连续 N 天进度无变化且 status=active |
| 健康度评分 | 综合逾期/停滞/阻塞计算 0-100 分 |

---

## 十一、非功能性需求

| 维度 | 要求 |
|------|------|
| **部署** | docker-compose 一键部署，单机运行 |
| **数据库** | SQLite 单文件，零配置，易备份 |
| **性能** | 支持 1000+ 节点的流畅操作 |
| **MCP 传输** | SSE 支持远程连接 |
| **安全** | API Token 认证 |

---

## 十二、成功指标

| 指标 | 目标值 |
|------|--------|
| 节点创建耗时 | < 1 秒（Tab 到 Enter） |
| MCP 工具响应 | < 500ms (P95) |
| Web UI 首屏加载 | < 2s |
| Agent 接入成本 | < 10 分钟 |
